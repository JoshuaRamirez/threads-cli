# storage/ - Data Persistence

Handles all file I/O for the Threads CLI. Data is stored in `~/.threads/threads.json`.

## File Locations

```
~/.threads/
  threads.json        # Main data file
  threads.backup.json # Automatic backup (created before each write)
```

## Core Functions

### Data Loading/Saving
- `loadData(): ThreadsData` - Load entire data store
- `saveData(data: ThreadsData): void` - Save with automatic backup

### Thread CRUD
- `getAllThreads(): Thread[]`
- `getThreadById(id: string): Thread | undefined`
- `getThreadByName(name: string): Thread | undefined` - Case-insensitive
- `findThreads(predicate): Thread[]` - Filter with callback
- `addThread(thread: Thread): void`
- `updateThread(id, updates): Thread | undefined` - Partial update
- `deleteThread(id: string): boolean`

### Group CRUD
- `getAllGroups(): Group[]`
- `getGroupById(id: string): Group | undefined`
- `getGroupByName(name: string): Group | undefined` - Case-insensitive
- `addGroup(group: Group): void`
- `updateGroup(id, updates): Group | undefined`
- `deleteGroup(id: string): boolean`

### Backup/Undo
- `getBackupInfo(): BackupInfo` - Check if backup exists
- `loadBackupData(): ThreadsData | undefined`
- `restoreFromBackup(): boolean` - Swap current with backup

## Design Patterns

### No Caching
Every read operation loads from disk. This ensures:
- CLI invocations always see current data
- External edits are never lost
- Simple mental model (no cache invalidation)

### Automatic Backup
Every `saveData()` call copies current file to backup first:
1. Copy `threads.json` to `threads.backup.json`
2. Write new data to `threads.json`

This enables single-step undo via `threads undo`.

### Partial Updates
`updateThread()` merges partial updates and auto-sets `updatedAt`:
```typescript
updateThread(id, { temperature: 'hot' }); // Only changes temperature
```

## Usage

```typescript
import { getAllThreads, updateThread, addThread } from '../storage';
```
